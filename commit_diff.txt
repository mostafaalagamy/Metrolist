commit 0edbdd9bec066a0808b520582a3a99240d2aa09c
Author: md anas <kabiranas7890@gmail.com>
Date:   Thu Feb 5 08:02:55 2026 +0530

    fix: widget visibility and playback sync issues
    
    - Fixed widget not appearing in widget picker due to missing string resources
    - Replaced Android 12+ system colors with compatible hex colors for all versions
    - Removed duplicate widget string resources
    - Cleaned up widget update code in MusicService
    - Updated README with widget feature and contributor credit
    
    Fixes widget compatibility for Android 8.0+ devices
    Contributor: md4n4s28

diff --git a/README.md b/README.md
index 989c94df..1063ed99 100644
--- a/README.md
+++ b/README.md
@@ -58,7 +58,8 @@ If you're in a region where YouTube Music is not supported, you won't be able to
 - Audio normalization 
 - Adjust tempo/pitch 
 - Local playlist management
-- Reorder songs in playlist or queue 
+- Reorder songs in playlist or queue
+- Home screen widget with playback controls
 - Light - Dark - black - Dynamic theme
 - Sleep timer
 - Material 3 
diff --git a/app/src/main/kotlin/com/metrolist/music/playback/MusicService.kt b/app/src/main/kotlin/com/metrolist/music/playback/MusicService.kt
index d7e2d7b6..86450434 100644
--- a/app/src/main/kotlin/com/metrolist/music/playback/MusicService.kt
+++ b/app/src/main/kotlin/com/metrolist/music/playback/MusicService.kt
@@ -2398,11 +2398,10 @@ class MusicService :
     }
 
     override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {
-        // Intercept Widget Commands (both legacy and Glance widgets use same actions)
         when (intent?.action) {
             MusicWidgetActions.ACTION_PLAY_PAUSE -> {
                 if (player.isPlaying) player.pause() else player.play()
-                updateWidgetUI(player.isPlaying) // Instant UI update
+                updateWidgetUI(player.isPlaying)
             }
             MusicWidgetActions.ACTION_NEXT -> {
                 player.seekToNext()
@@ -2424,11 +2423,12 @@ class MusicService :
             }
         }
 
-        // IMPORTANT: Pass everything else to Media3 so notification buttons still work!
         return super.onStartCommand(intent, flags, startId)
     }
 
-    // --- WIDGET UPDATE HELPER ---
+    /**
+     * Updates all app widgets with current playback state
+     */
     private fun updateWidgetUI(isPlaying: Boolean) {
         try {
             val context = this
@@ -2440,7 +2440,6 @@ class MusicService :
                 val artistName = songData?.artists?.joinToString(", ") { it.name } ?: getString(R.string.tap_to_open)
                 val isLiked = songData?.song?.liked == true
 
-                // Update Music Widget
                 try {
                     MusicWidget.updateWidget(
                         context = context,
@@ -2450,11 +2449,10 @@ class MusicService :
                         albumArtUrl = song?.thumbnailUrl,
                         isLiked = isLiked
                     )
-                } catch (e: Exception) {
-                    // Glance widget may not be added
+                } catch (_: Exception) {
+                    // Widget not added to home screen
                 }
 
-                // Update Turntable Widget
                 try {
                     TurntableWidget.updateWidget(
                         context = context,
@@ -2462,12 +2460,11 @@ class MusicService :
                         albumArtUrl = song?.thumbnailUrl,
                         isLiked = isLiked
                     )
-                } catch (e: Exception) {
-                    // Turntable widget may not be added
+                } catch (_: Exception) {
+                    // Widget not added to home screen
                 }
             }
         } catch (e: Exception) {
-            // Fail silently on Wear OS or other platforms without widget support
             reportException(e)
         }
     }
diff --git a/app/src/main/res/drawable-night/widget_album_art_background.xml b/app/src/main/res/drawable-night/widget_album_art_background.xml
index 9a710aec..0acbf722 100644
--- a/app/src/main/res/drawable-night/widget_album_art_background.xml
+++ b/app/src/main/res/drawable-night/widget_album_art_background.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <shape xmlns:android="http://schemas.android.com/apk/res/android"
     android:shape="rectangle">
-    <solid android:color="@android:color/system_accent1_700" />
+    <solid android:color="#4A4458" />
     <corners android:radius="20dp" />
 </shape>
diff --git a/app/src/main/res/drawable-night/widget_background.xml b/app/src/main/res/drawable-night/widget_background.xml
index 092b5765..1a791a30 100644
--- a/app/src/main/res/drawable-night/widget_background.xml
+++ b/app/src/main/res/drawable-night/widget_background.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <shape xmlns:android="http://schemas.android.com/apk/res/android"
     android:shape="rectangle">
-    <solid android:color="@android:color/system_accent1_800" />
+    <solid android:color="#2D2D2D" />
     <corners android:radius="28dp" />
 </shape>
diff --git a/app/src/main/res/drawable-night/widget_play_button_background.xml b/app/src/main/res/drawable-night/widget_play_button_background.xml
index 91e8a3ec..c76c9e99 100644
--- a/app/src/main/res/drawable-night/widget_play_button_background.xml
+++ b/app/src/main/res/drawable-night/widget_play_button_background.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <ripple xmlns:android="http://schemas.android.com/apk/res/android"
-    android:color="@android:color/system_accent1_500">
+    android:color="#7E57C2">
     <item android:id="@android:id/mask">
         <shape android:shape="oval">
             <solid android:color="@android:color/white" />
@@ -8,7 +8,7 @@
     </item>
     <item>
         <shape android:shape="oval">
-            <solid android:color="@android:color/system_accent1_300" />
+            <solid android:color="#4F378B" />
         </shape>
     </item>
 </ripple>
diff --git a/app/src/main/res/drawable/widget_album_art_background.xml b/app/src/main/res/drawable/widget_album_art_background.xml
index d5e8ec16..ad9ed900 100644
--- a/app/src/main/res/drawable/widget_album_art_background.xml
+++ b/app/src/main/res/drawable/widget_album_art_background.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <shape xmlns:android="http://schemas.android.com/apk/res/android"
     android:shape="rectangle">
-    <solid android:color="@android:color/system_accent1_200" />
+    <solid android:color="#E8DEF8" />
     <corners android:radius="20dp" />
 </shape>
diff --git a/app/src/main/res/drawable/widget_background.xml b/app/src/main/res/drawable/widget_background.xml
index 4da7debc..63a83cf5 100644
--- a/app/src/main/res/drawable/widget_background.xml
+++ b/app/src/main/res/drawable/widget_background.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <shape xmlns:android="http://schemas.android.com/apk/res/android"
     android:shape="rectangle">
-    <solid android:color="@android:color/system_accent1_100" />
+    <solid android:color="#F5F5F5" />
     <corners android:radius="28dp" />
 </shape>
diff --git a/app/src/main/res/drawable/widget_play_button_background.xml b/app/src/main/res/drawable/widget_play_button_background.xml
index 54060fc5..62541bb1 100644
--- a/app/src/main/res/drawable/widget_play_button_background.xml
+++ b/app/src/main/res/drawable/widget_play_button_background.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <ripple xmlns:android="http://schemas.android.com/apk/res/android"
-    android:color="@android:color/system_accent1_500">
+    android:color="#9575CD">
     <item android:id="@android:id/mask">
         <shape android:shape="oval">
             <solid android:color="@android:color/white" />
@@ -8,7 +8,7 @@
     </item>
     <item>
         <shape android:shape="oval">
-            <solid android:color="@android:color/system_accent1_100" />
+            <solid android:color="#D0BCFF" />
         </shape>
     </item>
 </ripple>
